<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Persistent cybersecurity threat management"><meta name=author content="Threat Patrols Pty. Ltd."><link href=https://documentation.threatpatrols.com/opnsense/plugins/configsync/ rel=canonical><link href=../autossh/ rel=prev><link rel=icon href=../../../assets/threatpatrols-eyeprint-black-64x64.png><meta name=generator content="mkdocs-1.4.3, mkdocs-material-9.1.18"><title>ConfigSync Plugin - ThreatPatrols.com</title><link rel=stylesheet href=../../../assets/stylesheets/main.26e3688c.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ecc896b0.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-9NNGGVVENZ"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-9NNGGVVENZ",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-9NNGGVVENZ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=grey> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#configuration-sync-configsync-for-opnsense class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=ThreatPatrols.com class="md-header__button md-logo" aria-label=ThreatPatrols.com data-md-component=logo> <img src=../../../assets/threatpatrols-eyeprint-white-64x64.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ThreatPatrols.com </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> ConfigSync Plugin </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=grey aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=grey aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/threatpatrols/documentation title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> threatpatrols/documentation </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=../../ class="md-tabs__link md-tabs__link--active"> OPNsense Resources </a> </li> <li class=md-tabs__item> <a href=https://www.threatpatrols.com class=md-tabs__link> ThreatPatrols.com </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=ThreatPatrols.com class="md-nav__button md-logo" aria-label=ThreatPatrols.com data-md-component=logo> <img src=../../../assets/threatpatrols-eyeprint-white-64x64.png alt=logo> </a> ThreatPatrols.com </label> <div class=md-nav__source> <a href=https://github.com/threatpatrols/documentation title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> threatpatrols/documentation </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Documentation </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <div class="md-nav__link md-nav__link--index "> <a href=../../ >OPNsense Resources</a> <label for=__nav_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> OPNsense Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../repo/ class=md-nav__link> OPNsense Repo </a> </li> <li class=md-nav__item> <a href=../../mirror/ class=md-nav__link> OPNsense Mirror </a> </li> <li class=md-nav__item> <a href=../autossh/ class=md-nav__link> Autossh Plugin </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> ConfigSync Plugin <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> ConfigSync Plugin </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#installation class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=#general-settings-recommendations class=md-nav__link> General Settings Recommendations </a> </li> <li class=md-nav__item> <a href=#storage-provider-settings class=md-nav__link> Storage Provider Settings </a> <nav class=md-nav aria-label="Storage Provider Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aws-s3 class=md-nav__link> AWS - S3 </a> </li> <li class=md-nav__item> <a href=#google-cloud-storage class=md-nav__link> Google - Cloud Storage </a> </li> <li class=md-nav__item> <a href=#digital-ocean-spaces class=md-nav__link> Digital Ocean - Spaces </a> </li> <li class=md-nav__item> <a href=#other-s3-compatible class=md-nav__link> Other - S3 compatible </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#storage-metadata class=md-nav__link> Storage Metadata </a> </li> <li class=md-nav__item> <a href=#issues class=md-nav__link> Issues </a> </li> <li class=md-nav__item> <a href=#source class=md-nav__link> Source </a> </li> <li class=md-nav__item> <a href=#copyright class=md-nav__link> Copyright </a> </li> <li class=md-nav__item> <a href=#license class=md-nav__link> License </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://www.threatpatrols.com class=md-nav__link> ThreatPatrols.com </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=configuration-sync-configsync-for-opnsense>Configuration Sync (configsync) for OPNsense<a class=headerlink href=#configuration-sync-configsync-for-opnsense title="Permanent link">&para;</a></h1> <p><img align=right alt="Configuration Sync Menu" src=assets/opnsense-menu-configsync.png></p> <p>Configuration Sync (configsync) is an OPNsense plugin designed to one-way synchronize the OPNsense system configuration <code>.xml</code> files to an (S3 compatible) cloud-storage provider. Actions for <code>configsync</code> are automatically triggered by an OPNsense syshook-config event.</p> <p>Configuration Sync is well-suited to DevOps automation situations where OPNsense instances are re-invoked with a previously existing configuration - such as when using MultiCLOUDsense to handle the bootstrapping of an OPNsense cloud instance.</p> <p>Configuration Sync also happens to be a great OPNsense configuration backup solution when used by itself.</p> <p>Configuration Sync supports the following cloud storage providers:-</p> <ul> <li>Amazon Web Services - S3</li> <li>Google - Cloud Storage</li> <li>Digital Ocean - Spaces</li> <li>Other - S3 compatible endpoints</li> </ul> <p>Configuration Sync uses the well known <a href=https://boto3.amazonaws.com/v1/documentation/api/latest/index.html>Python Boto3</a> library to achieve generic S3 connectivity; if Boto3 can handle the S3 storage provider you should be able to use it here.</p> <h2 id=installation>Installation<a class=headerlink href=#installation title="Permanent link">&para;</a></h2> <p>Installation from the Threat Patrols package repository is possible using the standard OPNsense Firmware-Plugin web-interface after the <code>os-threatpatrols</code> plugin has been added to your system.</p> <ul> <li>Package Repository: <a href=/opnsense/repo/ >opnsense/repo</a></li> </ul> <h2 id=general-settings-recommendations>General Settings Recommendations<a class=headerlink href=#general-settings-recommendations title="Permanent link">&para;</a></h2> <p><img align=right alt="Configuration Sync Settings" src=assets/configsync-screenshot01.png></p> <ul> <li><strong>Storage Path</strong> - recommend that you use different storage paths per OPNsense instance else you will end up with configuration files from multiple OPNsense instances in the same S3 storage path that will clobber the <code>config-current.xml</code> of one another. If this does occur, it is possible to examine the S3-object meta-data attributes that are added by ConfigSync to determine which files belong to each OPNsense instance.</li> <li><strong>API Key / API Secret Credentials</strong> - strongly recommend that you use a dedicated service-account with an access policy that constrains the service-account to permissions allowing <code>list-bucket</code> and <code>put-bucket</code> actions (or the storage-provider equivalent of these). The Configuration Sync tool is designed to <strong>not</strong> require any <code>get-object</code> or other object-read access which in-turn greatly limits risks associated with these API credentials, if this restrictive service-account policy is applied.</li> </ul> <h2 id=storage-provider-settings>Storage Provider Settings<a class=headerlink href=#storage-provider-settings title="Permanent link">&para;</a></h2> <h3 id=aws-s3>AWS - S3<a class=headerlink href=#aws-s3 title="Permanent link">&para;</a></h3> <ul> <li><strong>Endpoint URL Override</strong> - generally not required for AWS-S3 since the URL endpoint for AWS-S3 is self-determined using their <a href=https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-bucket-intro.html>virtual-hostedâ€“style</a> bucket access that uses a CNAME arrangement to direct requests to the correct AWS region for your bucket.</li> <li> <p><strong>Example IAM Policy</strong> - the AWS IAM policy below describes the minimum permissions policy required by a ConfigSync service account. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=p>{</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>    </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>        </span><span class=p>{</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>            </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>            </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&quot;s3:ListBucket&quot;</span><span class=w> </span><span class=p>],</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>            </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&quot;arn:aws:s3:::BUCKET_NAME&quot;</span><span class=w> </span><span class=p>]</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>        </span><span class=p>{</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>            </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>            </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&quot;s3:ListBucket&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;s3:PutObject&quot;</span><span class=w> </span><span class=p>],</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>            </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&quot;arn:aws:s3:::BUCKET_NAME/PATH_NAME/*&quot;</span><span class=w> </span><span class=p>]</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>    </span><span class=p>]</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=p>}</span>
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Be sure to replace the <code>BUCKET_NAME</code> and <code>PATH_NAME</code> values with your own values if you plan to cut-n-paste from above.</p> </div> </li> </ul> <h3 id=google-cloud-storage>Google - Cloud Storage<a class=headerlink href=#google-cloud-storage title="Permanent link">&para;</a></h3> <p><img align=right alt="Google HMAC Credential" src=assets/google-hmac-credential01.png></p> <ul> <li><strong>Endpoint URL Override</strong> - is not required for Google Cloud storage.</li> <li><strong>API Key / API Secret Credentials</strong> - Google requires the creation of S3 compatible <a href=https://cloud.google.com/storage/docs/authentication/hmackeys>HMAC keys</a>.</li> <li>Creating HMAC credentials in brief<ul> <li>Step-1) create a service account with restrictions allowing object-list and object-write to your bucket, do not create any keys or other credentials for the service-account yet.</li> <li>Step-2) navigate to your Google Storage bucket, select <strong>Settings</strong> &gt; <strong>Interoperability</strong> then the "Create a key for another service account" button.</li> <li>Step 3) check the credentials using the Configuration Sync settings interface using the "Test Credentials" button</li> </ul> </li> </ul> <h3 id=digital-ocean-spaces>Digital Ocean - Spaces<a class=headerlink href=#digital-ocean-spaces title="Permanent link">&para;</a></h3> <ul> <li><strong>Endpoint URL Override</strong> - is required for Digital Ocean and should be specified in the form <code>https://&lt;region&gt;.digitaloceanspaces.com</code> for example use <code>https://sgp1.digitaloceanspaces.com</code> for Singapore.</li> <li> <p><strong>API Key / API Secret Credentials</strong> - Digital Ocean provides S3 compatible credentials out-of-the-box that are accessed by navigating <strong>API</strong> &gt; <strong>Tokens/Keys</strong> &gt; <strong>Spaces access keys</strong></p> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>Digital Ocean does not currently provide the same type of service-accounts or access policies that are possible with Google, AWS and others. You may need to consider if this type of unrestricted bucket-access is appropriate for your use case.</p> </div> </li> </ul> <h3 id=other-s3-compatible>Other - S3 compatible<a class=headerlink href=#other-s3-compatible title="Permanent link">&para;</a></h3> <p><img align=right alt="MinIO Example Config" src=assets/minio-example01.png></p> <ul> <li>Configuration Sync has been tested with and is known to work with MinIO. </li> <li><strong>Endpoint URL Override</strong> - for example <code>http://192.168.100.252:9000</code> NB: the risks with clear text http in this example URL; MinIO can (and should) be deployed on https.</li> <li><strong>API Key / API Secret Credentials</strong> - A service-account with a policy similar to the AWS example works well.</li> <li>The ability to create service-accounts and apply restrictive policies makes MinIO an appealing self-hosted option.</li> </ul> <p><br></p> <h2 id=storage-metadata>Storage Metadata<a class=headerlink href=#storage-metadata title="Permanent link">&para;</a></h2> <p>Each OPNsense <code>.xml</code> file object written by Configuration Sync adds extra meta-data to the stored file-object that helps confirm the OPNsense instance the file originated from.</p> <p><img align=right alt="Digital Ocean Metadata Example" src=assets/digitalocean-metadata-example01.png></p> <p>These fields are</p> <ul> <li><code>filetype</code> - always "opnsense-config"</li> <li><code>mtime</code> - the last modified timestamp of the OPNsense config file</li> <li><code>bytes</code> - the file size in bytes of the OPNsense config file</li> <li><code>md5</code> - the md5-digest of the OPNsense config file</li> <li><code>hostid</code> - the unique host-id of the OPNsense system</li> <li><code>hostname</code> - the hostname of the OPNsense system</li> </ul> <p>These values are helpful in filtering and selecting specific configuration files from the storage-provider bucket at a later time.</p> <p>(Don't worry the observable attributes in the screenshot are not a thing)</p> <hr> <h2 id=issues>Issues<a class=headerlink href=#issues title="Permanent link">&para;</a></h2> <p>Please post issues via Github:</p> <ul> <li><a href=https://github.com/threatpatrols/opnsense-plugin-configsync/issues>https://github.com/threatpatrols/opnsense-plugin-configsync/issues</a> </li> </ul> <h2 id=source>Source<a class=headerlink href=#source title="Permanent link">&para;</a></h2> <ul> <li><a href=https://github.com/threatpatrols/opnsense-plugin-configsync>https://github.com/threatpatrols/opnsense-plugin-configsync</a></li> </ul> <h2 id=copyright>Copyright<a class=headerlink href=#copyright title="Permanent link">&para;</a></h2> <ul> <li>Copyright &copy; 2022-2025 Threat Patrols Pty Ltd &lt;<a href=mailto:contact@threatpatrols.com>&#99;&#111;&#110;&#116;&#97;&#99;&#116;&#64;&#116;&#104;&#114;&#101;&#97;&#116;&#112;&#97;&#116;&#114;&#111;&#108;&#115;&#46;&#99;&#111;&#109;</a>&gt;</li> <li>Copyright &copy; 2018 Verb Networks Pty Ltd &lt;<a href=mailto:contact@verbnetworks.com>&#99;&#111;&#110;&#116;&#97;&#99;&#116;&#64;&#118;&#101;&#114;&#98;&#110;&#101;&#116;&#119;&#111;&#114;&#107;&#115;&#46;&#99;&#111;&#109;</a>&gt;</li> <li>Copyright &copy; 2018 Nicholas de Jong &lt;<a href=mailto:me@nicholasdejong.com>&#109;&#101;&#64;&#110;&#105;&#99;&#104;&#111;&#108;&#97;&#115;&#100;&#101;&#106;&#111;&#110;&#103;&#46;&#99;&#111;&#109;</a>&gt;</li> </ul> <p>All rights reserved.</p> <h2 id=license>License<a class=headerlink href=#license title="Permanent link">&para;</a></h2> <p>BSD-2-Clause - see LICENSE file for full details.</p> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021 - 2024 Threat Patrols Pty. Ltd. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://www.threatpatrols.com target=_blank rel=noopener title=www.threatpatrols.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25ZM14.5 6h-13v7.25c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25Zm-6-3.5v2h6V2.75a.25.25 0 0 0-.25-.25ZM5 2.5v2h2v-2Zm-3.25 0a.25.25 0 0 0-.25.25V4.5h2v-2Z"/></svg> </a> <a href=https://github.com/threatpatrols target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/threatpatrols target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.code.annotate", "content.tooltips", "navigation.expand", "navigation.indexes", "navigation.instant", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "toc.integrate", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.220ee61c.min.js></script> </body> </html>